<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kitamura OCR Extractor</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f5f5f5; }
    h2 { color: #333; }
    input, select, button, textarea { font-size: 16px; margin: 6px 0; padding: 6px; width: 100%; max-width: 400px; }
    button { background: #0078d7; color: white; border: none; border-radius: 6px; cursor: pointer; padding: 10px; }
    button:hover { background: #005ea3; }
    textarea { height: 80px; }
    #result { margin-top: 20px; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 0 6px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h2>ğŸ“¸ ã‚­ã‚¿ãƒ ãƒ©ãƒ—ãƒ©ã‚¤ã‚¹ã‚«ãƒ¼ãƒ‰æƒ…å ±æŠ½å‡º</h2>
  <input type="file" id="imageInput" accept="image/*"><br>
  <select id="condition">
    <option value="">Select Condition</option>
    <option>Unused</option>
    <option>TOP MINT</option>
    <option>MINT</option>
    <option>NEAR MINT+++</option>
    <option>NEAR MINT</option>
    <option>EXCELLENT5</option>
    <option>EXCELLENT3</option>
    <option>AS IS/For PARTS</option>
  </select><br>
  <input type="number" id="price" placeholder="Expected Price (USD)"><br>
  <textarea id="note" placeholder="Notes"></textarea><br>
  <button id="extractBtn">Extract Info</button>
  <div id="result"></div>

  <script>
  document.getElementById("extractBtn").onclick = async function processImage() {
    const fileInput = document.getElementById("imageInput");
    if (!fileInput.files.length) return alert("ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„");
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = async function () {
      const imageBase64 = reader.result;
      document.getElementById("result").innerText = "ğŸ”„ èªè­˜ä¸­...";
      try {
        const res = await fetch("/.netlify/functions/openai-function", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ imageBase64 })
        });
        const result = await res.json();
        console.log("âœ… AIã‹ã‚‰ã®æœ€çµ‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹:", result);

        const name = result.å•†å“?.åå‰ || "ä¸æ˜";
        const priceJP = result.å•†å“?.ä¾¡æ ¼ || "ä¸æ˜";
        const condition = document.getElementById("condition").value || "";
        const priceUSD = document.getElementById("price").value || "";
        const note = document.getElementById("note").value || "";

        const output = `${name}, ${priceJP}, ${condition}, ${priceUSD}, ${note}`;
        document.getElementById("result").innerHTML =
          `<b>å‡ºåŠ›çµæœ:</b><br>${output}<br><br><button id="copyBtn">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>`;

        // âœ… ã‚³ãƒ”ãƒ¼ç”¨ãƒœã‚¿ãƒ³ã‚’å‹•ä½œã•ã›ã‚‹
        document.getElementById("copyBtn").onclick = async () => {
          try {
            await navigator.clipboard.writeText(output);
            alert("ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
          } catch {
            alert("âš ï¸ è‡ªå‹•ã‚³ãƒ”ãƒ¼ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚\næ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚");
          }
        };
      } catch (err) {
        document.getElementById("result").innerText = "âŒ ã‚¨ãƒ©ãƒ¼: " + err.message;
      }
    };
  };
</script>

</body>
</html>

