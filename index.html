<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kitamura OCR Extractor</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f5f5f5; }
    h2 { color: #333; }
    input, select, button, textarea { font-size: 16px; margin: 6px 0; padding: 6px; width: 100%; max-width: 400px; }
    button { background: #0078d7; color: white; border: none; border-radius: 6px; cursor: pointer; padding: 10px; }
    button:hover { background: #005ea3; }
    textarea { height: 80px; }
    #resultBox { margin-top: 20px; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 0 6px rgba(0,0,0,0.1); }
    #editableOutput { width: 100%; height: 90px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; padding: 6px; }
  </style>
</head>
<body>
  <h2>ğŸ“¸ ã‚­ã‚¿ãƒ ãƒ©ãƒ—ãƒ©ã‚¤ã‚¹ã‚«ãƒ¼ãƒ‰æƒ…å ±æŠ½å‡º</h2>
  <input type="file" id="imageInput" accept="image/*"><br>
  <select id="condition">
    <option value="">Select Condition</option>
    <option>Unused</option>
    <option>TOP MINT</option>
    <option>MINT</option>
    <option>NEAR MINT+++</option>
    <option>NEAR MINT</option>
    <option>EXCELLENT5</option>
    <option>EXCELLENT3</option>
    <option>AS IS/For PARTS</option>
  </select><br>
  <input type="number" id="price" placeholder="Expected Price (USD)"><br>
  <textarea id="note" placeholder="Notes"></textarea><br>
  <button id="extractBtn">Extract Info</button>

  <div id="resultBox">
    <div id="result">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
    <textarea id="editableOutput" placeholder="æŠ½å‡ºçµæœã‚’ã“ã“ã§ä¿®æ­£ã§ãã¾ã™"></textarea><br>
    <button id="copyBtn" style="display:none;">ğŸ“‹ ä¿®æ­£å¾Œã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼</button>
  </div>

  <script>
    document.getElementById("extractBtn").onclick = async function processImage() {
      const fileInput = document.getElementById("imageInput");
      if (!fileInput.files.length) return alert("ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„");
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = async function () {
        const imageBase64 = reader.result;
        document.getElementById("result").innerText = "ğŸ”„ èªè­˜ä¸­...";
        document.getElementById("editableOutput").value = "";
        document.getElementById("copyBtn").style.display = "none";
        try {
          const res = await fetch("/.netlify/functions/openai-function", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ imageBase64 })
          });
          const result = await res.json();
          console.log("âœ… AIã‹ã‚‰ã®æœ€çµ‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹:", result);

          const name = result.å•†å“?.åå‰ || "ä¸æ˜";
          const priceJP = result.å•†å“?.ä¾¡æ ¼ || "ä¸æ˜";
          const condition = document.getElementById("condition").value || "";
          const priceUSD = document.getElementById("price").value || "";
          const note = document.getElementById("note").value || "";

          const output = `${name}, ${priceJP}, ${condition}, ${priceUSD}, ${note}`;
          document.getElementById("result").innerText = "âœ… æŠ½å‡ºå®Œäº†ï¼ˆä¿®æ­£ã§ãã¾ã™ï¼‰";
          document.getElementById("editableOutput").value = output;
          document.getElementById("copyBtn").style.display = "inline-block";

        } catch (err) {
          document.getElementById("result").innerText = "âŒ ã‚¨ãƒ©ãƒ¼: " + err.message;
        }
      };
    };

    document.getElementById("copyBtn").onclick = async function () {
      const text = document.getElementById("editableOutput").value;
      try {
        await navigator.clipboard.writeText(text);
        alert("ğŸ“‹ ä¿®æ­£å¾Œã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n" + text);
      } catch {
        alert("âš ï¸ è‡ªå‹•ã‚³ãƒ”ãƒ¼ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚");
      }
    };
  </script>
</body>
</html>
